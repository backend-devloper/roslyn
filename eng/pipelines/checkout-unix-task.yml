# Shallow checkout sources on Unix

parameters:
- name: depth
  type: number
  default: 1

steps:
  - ${{ if eq(variables['System.TeamProject'], 'public') }}:
    - checkout: none

    - script: |
        set -x
        git init
        git config --local checkout.workers 0
        git config --local fetch.parallel 0
        git remote add origin "$(Build.Repository.Uri)"
        git fetch --no-tags --no-auto-maintenance --depth=${{ parameters.depth }} origin "$(Build.SourceVersion)"
        git checkout "$(Build.SourceVersion)"
      displayName: Shallow Checkout
  - ${{ if ne(variables['System.TeamProject'], 'public') }}:
    - checkout: self
      fetchDepth: ${{ parameters.depth }}
      fetchTags: false

  
