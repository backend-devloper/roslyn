<Project Sdk="Microsoft.NET.Sdk">
    <PropertyGroup>
        <OutputType>Exe</OutputType>
        <TargetFramework>net7.0</TargetFramework>
        <ImplicitUsings>enable</ImplicitUsings>
        <Nullable>enable</Nullable>
        <ArtifactsPath>../../artifacts</ArtifactsPath>
        <BaseOutputPath>$(ArtifactsPath)/bin</BaseOutputPath>

        <!-- Publishing settings -->
        <SelfContained>False</SelfContained>
        <PublishDir Condition="'$(RuntimeIdentifier)' != ''">$(ArtifactsPath)/publish/$(Configuration)/$(TargetFramework)/$(RuntimeIdentifier)</PublishDir>
        <PublishDir Condition="'$(RuntimeIdentifier)' == ''">$(ArtifactsPath)/publish/$(Configuration)/$(TargetFramework)/neutral</PublishDir>
        <!-- Set the minimum runtime to a .NET 7 prerelease so that prerelease SDKs will be considered during rollForward. -->
        <RuntimeFrameworkVersion>7.0.0-preview.7.22362.8</RuntimeFrameworkVersion>
        <RollForward>LatestMajor</RollForward>
    </PropertyGroup>

    <ItemGroup>
        <PackageReference Include="Microsoft.Build" Version="$(MicrosoftBuildVersion)" ExcludeAssets="runtime" />
        <PackageReference Include="Microsoft.Build.Locator" Version="$(MicrosoftBuildLocatorVersion)" />
        <PackageReference Include="Microsoft.CodeAnalysis.LanguageServer.Protocol" Version="$(MicrosoftCodeAnalysisLanguageServerProtocolVersion)" />
        <PackageReference Include="Microsoft.CodeAnalysis.Workspaces.Desktop" Version="$(MicrosoftCodeAnalysisWorkspacesDesktopVersion)" />
        <PackageReference Include="Microsoft.CodeAnalysis.Workspaces.MSBuild" Version="$(MicrosoftCodeAnalysisWorkspacesMSBuildVersion)" />
        <PackageReference Include="Microsoft.CodeAnalysis.Remote.Workspaces" Version="$(MicrosoftCodeAnalysisRemoteWorkspacesVersion)" />
        <PackageReference Include="Microsoft.Extensions.Logging" Version="$(MicrosoftExtensionsLoggingVersion)" />
        <PackageReference Include="Microsoft.Extensions.Logging.Abstractions" Version="$(MicrosoftExtensionsLoggingAbstractionsVersion)" />
        <PackageReference Include="Microsoft.Extensions.Logging.Console" Version="$(MicrosoftExtensionsLoggingConsoleVersion)" />
        <PackageReference Include="Microsoft.ServiceHub.Framework" Version="$(MicrosoftServiceHubFrameworkVersion)" />
        <PackageReference Include="Microsoft.VisualStudio.Composition" Version="$(MicrosoftVisualStudioCompositionVersion)" />
        <PackageReference Include="Microsoft.VisualStudio.LanguageServer.Protocol" Version="$(MicrosoftVisualStudioLanguageServerProtocolVersion)" />
        <PackageReference Include="StreamJsonRpc" Version="$(StreamJsonRpcVersion)" />
        <PackageReference Include="System.CommandLine" Version="$(SystemCommandLineVersion)" />

        <!-- Dlls we don't directly reference but need to include to build the MEF composition -->
        <PackageReference Include="Microsoft.CodeAnalysis.CSharp.Features" Version="$(MicrosoftCodeAnalysisCSharpFeaturesVersion)" />
    </ItemGroup>

    <ItemGroup>
        <InternalsVisibleTo Include="Microsoft.CodeAnalysis.LanguageServer.UnitTests" Key="$(MicrosoftCodeAnalysisLanguageServerKey)" />
    </ItemGroup>

    <ItemGroup>
        <RoslynVersionFile Include="$(OutDir)\RoslynVersion.txt" />
        <FileWrites Include="@(RoslynVersionFile)" />
    </ItemGroup>

    <Target Name="WriteRoslynVersion" AfterTargets="Build">
        <WriteLinesToFile File="@(RoslynVersionFile)" Lines="$(MicrosoftCodeAnalysisVersion)" Overwrite="true" />
    </Target>

    <Target Name="PublishRoslynVersion" AfterTargets="Publish">
        <Copy SourceFiles="@(RoslynVersionFile)" DestinationFolder="$(PublishDir)" />
    </Target>

</Project>
